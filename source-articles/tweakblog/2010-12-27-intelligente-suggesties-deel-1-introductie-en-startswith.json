{
    "title": "Intelligente suggesties, deel 1: Introductie en 'StartsWith'",
    "language": "nl",
    "link": "http://glamour.tweakblogs.net/blog/5832/intelligente-suggesties-deel-1-introductie-en-startswith.html",
    "date": "2010-12-27T13:23:00.000Z",
    "category": "Algoritmes",
    "views": 3773,
    "articleHtml": "Dit is deel 1 in een serie over de techniek uit een &apos;intelligente&apos; zoekbox.<ul><li><b>1. Introductie en &apos;StartsWith&apos;</b></li><li><a href=\"http://glamour.tweakblogs.net/blog/5842/intelligente-suggesties-deel-2-volledige-matching-en-typfouten.html\" rel=\"external\">2. Volledige matching en typfouten</a></li><li><a href=\"http://glamour.tweakblogs.net/blog/5849/intelligente-suggesties-deel-3-uitspraak-en-hierarchie.html\" rel=\"external\">3. Uitspraak en hierarchie</a></li><li><a href=\"http://glamour.tweakblogs.net/blog/5853/intelligente-suggesties-deel-4-aantallen-caching-en-protocol-buffers.html\" rel=\"external\">4. Aantallen, caching en Protocol Buffers</a></li></ul>Enkele weken geleden werd mij een functioneel ontwerp in de handen gedrukt met als enige opmerking: &apos;kijk eens of we dit kunnen maken&apos;. In twee weken bouwtijd was <a href=\"http://glamour.tweakblogs.net/blog/5813/video!-on-the-fly-zoeksuggesties-levenshtein-en-soundex-in-de-praktijk.html\" rel=\"external\">dit het resultaat</a>. Vandaag deel 1 in een serie over de techniek die het mogelijk maakt om in fracties van een seconde intelligente suggesties te geven.<br>\r\n<br>\r\n<b>Doelen</b><ul><li>Tonen van suggesties op basis van de input van de gebruiker</li><li>Suggesties kunnen zowel geheel matchen (&apos;Amsterdam&apos;), of gedeeltelijk (&apos;Amste&apos;)</li><li>Hierarchie moet ondersteunt worden (&apos;Amsterdam, Noord-Holland&apos;; &apos;Wibautstraat, Amsterdam&apos;)</li><li>Het aantal woningen dient naast de suggestie getoond te worden</li><li>Tolerant in invoer (&apos;K&#xF6;og a/d Zaan&apos; moet &apos;Koog aan de Zaan&apos; als suggestie geven)</li></ul>Wanneer er geen suggesties te geven zijn, moeten er alternatieven worden voorgesteld:<ul><li>Op basis van uitspraak gebieden vinden die hetzelfde klinken (&apos;Wiboudstraat&apos; en &apos;Wibautstraat&apos;)</li><li>Tolerantie voor typfouten (&apos;Utrect&apos;)</li><li>Omdraaien van de opdracht (&apos;Amsterdam, Pijp&apos; wordt &apos;Pijp, Amsterdam&apos;)</li></ul><a name=\"more\"></a><br>\r\n<b>Normaliseren van namen en zoekacties</b><br>\r\nVoor we data uit de database gaan halen, is het van belang om alle namen te normaliseren. Denk hierbij aan het strippen van spaties en <a href=\"http://glamour.tweakblogs.net/blog/5732/diakritische-tekens-en-soundex-in-net.html\" rel=\"external\">diakrieten</a>, en het gebruik van synoniemen.<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br></code></td><td class=\"phphighlightcode\"><div><code>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">private</span>&#xA0;<span class=\"code_keyword\">static</span>&#xA0;<span class=\"code_ident\">Regex</span>&#xA0;<span class=\"code_ident\">_alleenWordChars</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">Regex</span>(@<span class=\"code_string\">&quot;[^a-z0-9]+&quot;</span>,&#xA0;<span class=\"code_ident\">RegexOptions</span>.<span class=\"code_ident\">Compiled</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_method\">NormaliseerNaam</span>(<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">q</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">q</span>&#xA0;=&#xA0;<span class=\"code_ident\">q</span>.<span class=\"code_method\">Trim</span>();\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">q</span>&#xA0;=&#xA0;<span class=\"code_method\">NormaliseerHoofdlettergebruik</span>(<span class=\"code_ident\">q</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">q</span>&#xA0;=&#xA0;<span class=\"code_method\">NormaliseerDiakritisch</span>(<span class=\"code_ident\">q</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">q</span>&#xA0;=&#xA0;<span class=\"code_method\">NormaliseerSynoniemen</span>(<span class=\"code_ident\">q</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;alles&#xA0;wat&#xA0;nu&#xA0;nog&#xA0;geen&#xA0;a-z0-9&#xA0;eruit&#xA0;strippen</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">q</span>&#xA0;=&#xA0;<span class=\"code_ident\">_alleenWordChars</span>.<span class=\"code_method\">Replace</span>(<span class=\"code_ident\">q</span>,&#xA0;<span class=\"code_ident\">String</span>.<span class=\"code_ident\">Empty</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">return</span>&#xA0;<span class=\"code_ident\">q</span>;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">private</span>&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_method\">NormaliseerHoofdlettergebruik</span>&#xA0;(<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">q</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">return</span>&#xA0;<span class=\"code_ident\">q</span>.<span class=\"code_method\">ToLowerInvariant</span>();\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">private</span>&#xA0;<span class=\"code_keyword\">static</span>&#xA0;<span class=\"code_ident\">Encoding</span>&#xA0;<span class=\"code_ident\">removal</span>&#xA0;=&#xA0;<span class=\"code_ident\">Encoding</span>.<span class=\"code_method\">GetEncoding</span>(<span class=\"code_ident\">Encoding</span>.<span class=\"code_ident\">ASCII</span>.<span class=\"code_ident\">CodePage</span>,&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">EncoderReplacementFallback</span>(<span class=\"code_string\">&quot;&quot;</span>),&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">DecoderReplacementFallback</span>(<span class=\"code_string\">&quot;&quot;</span>));\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_method\">NormaliseerDiakritisch</span>(<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">q</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">normalized</span>&#xA0;=&#xA0;<span class=\"code_ident\">q</span>.<span class=\"code_method\">Normalize</span>(<span class=\"code_ident\">NormalizationForm</span>.<span class=\"code_ident\">FormD</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">byte</span>[]&#xA0;<span class=\"code_ident\">bytes</span>&#xA0;=&#xA0;<span class=\"code_ident\">removal</span>.<span class=\"code_method\">GetBytes</span>(<span class=\"code_ident\">normalized</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">return</span>&#xA0;<span class=\"code_ident\">Encoding</span>.<span class=\"code_ident\">ASCII</span>.<span class=\"code_method\">GetString</span>(<span class=\"code_ident\">bytes</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">private</span>&#xA0;<span class=\"code_keyword\">static</span>&#xA0;<span class=\"code_ident\">Dictionary</span>&lt;<span class=\"code_keyword\">string</span>,&#xA0;<span class=\"code_keyword\">string</span>&gt;&#xA0;<span class=\"code_ident\">_synoniemen</span>;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">private</span>&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_method\">NormaliseerSynoniemen</span>(<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">q</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">if</span>&#xA0;(<span class=\"code_ident\">_synoniemen</span>&#xA0;==&#xA0;<span class=\"code_keyword\">null</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">_synoniemen</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_ident\">Dictionary</span>&lt;<span class=\"code_keyword\">string</span>,&#xA0;<span class=\"code_keyword\">string</span>&gt;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{&#xA0;<span class=\"code_string\">&quot;ad&quot;</span>,&#xA0;<span class=\"code_string\">&quot;aan&#xA0;de&quot;</span>&#xA0;},\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{&#xA0;<span class=\"code_string\">&quot;a/d&quot;</span>,&#xA0;<span class=\"code_string\">&quot;aan&#xA0;de&quot;</span>&#xA0;},\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{&#xA0;<span class=\"code_string\">&quot;aan&#xA0;den&quot;</span>,&#xA0;<span class=\"code_string\">&quot;aan&#xA0;de&quot;</span>&#xA0;},\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{&#xA0;<span class=\"code_string\">&quot;1e&quot;</span>,&#xA0;<span class=\"code_string\">&quot;eerste&quot;</span>&#xA0;},\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{&#xA0;<span class=\"code_string\">&quot;2e&quot;</span>,&#xA0;<span class=\"code_string\">&quot;tweede&quot;</span>&#xA0;},\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{&#xA0;<span class=\"code_string\">&quot;3e&quot;</span>,&#xA0;<span class=\"code_string\">&quot;derde&quot;</span>&#xA0;},\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;};\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;special&#xA0;cases&#xA0;;&#xA0;regex&#xA0;is&#xA0;te&#xA0;langzaam</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">if</span>&#xA0;(<span class=\"code_ident\">q</span>.<span class=\"code_method\">StartsWith</span>(<span class=\"code_string\">&quot;de&#xA0;&quot;</span>))&#xA0;<span class=\"code_ident\">q</span>&#xA0;=&#xA0;<span class=\"code_ident\">q</span>.<span class=\"code_method\">Substring</span>(<span class=\"code_number\">3</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">if</span>&#xA0;(<span class=\"code_ident\">q</span>.<span class=\"code_method\">StartsWith</span>(<span class=\"code_string\">&quot;het&#xA0;&quot;</span>))&#xA0;<span class=\"code_ident\">q</span>&#xA0;=&#xA0;<span class=\"code_ident\">q</span>.<span class=\"code_method\">Substring</span>(<span class=\"code_number\">4</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">if</span>&#xA0;(<span class=\"code_ident\">q</span>.<span class=\"code_method\">Contains</span>(<span class=\"code_string\">&quot;&#xA0;in&#xA0;&quot;</span>))&#xA0;<span class=\"code_ident\">q</span>&#xA0;=&#xA0;<span class=\"code_ident\">q</span>.<span class=\"code_method\">Replace</span>(<span class=\"code_string\">&quot;&#xA0;in&#xA0;&quot;</span>,&#xA0;<span class=\"code_string\">&quot;&#xA0;&quot;</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">if</span>&#xA0;(<span class=\"code_ident\">q</span>.<span class=\"code_method\">EndsWith</span>(<span class=\"code_string\">&quot;&#xA0;in&quot;</span>))&#xA0;<span class=\"code_ident\">q</span>&#xA0;=&#xA0;<span class=\"code_ident\">q</span>.<span class=\"code_method\">Substring</span>(<span class=\"code_number\">0</span>,&#xA0;<span class=\"code_ident\">q</span>.<span class=\"code_ident\">Length</span>&#xA0;-&#xA0;<span class=\"code_number\">3</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">foreach</span>(<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">syn</span>&#xA0;<span class=\"code_keyword\">in</span>&#xA0;<span class=\"code_ident\">_synoniemen</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">q</span>&#xA0;=&#xA0;<span class=\"code_ident\">q</span>.<span class=\"code_method\">Replace</span>(<span class=\"code_ident\">syn</span>.<span class=\"code_ident\">Key</span>,&#xA0;<span class=\"code_ident\">syn</span>.<span class=\"code_ident\">Value</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">return</span>&#xA0;<span class=\"code_ident\">q</span>;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}</code></div></td></tr></table><br>\r\n<br>\r\n<b>Model</b><br>\r\nVoor het opslaan van de verschillende gebieden maken we gebruik van GIS-data die we aankopen. Tijdens de eerste run trekken we dit uit de database en slaan we dit op in een in-memory lijst. Van elk gebied hebben we nodig:<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br></code></td><td class=\"phphighlightcode\"><div><code>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">class</span>&#xA0;<span class=\"code_ident\">GeoGebied</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;Straat,&#xA0;Buurt,&#xA0;Regio&#xA0;etc.&#xA0;(gebruik&#xA0;hier&#xA0;een&#xA0;&apos;byte&apos;&#xA0;voor,&#xA0;lekker&#xA0;efficient)</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_ident\">Niveau</span>&#xA0;<span class=\"code_ident\">Niveau</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;Naam&#xA0;van&#xA0;het&#xA0;gebied&#xA0;(offici&#xEB;le&#xA0;schrijfwijze)</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">Naam</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;Uniek&#xA0;ID</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">int</span>&#xA0;<span class=\"code_ident\">Id</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;Het&#xA0;ID&#xA0;van&#xA0;de&#xA0;parent&#xA0;(bv.&#xA0;Zaandam&#xA0;heeft&#xA0;&apos;Gemeente&#xA0;Zaanstad&apos;)</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">int</span>&#xA0;<span class=\"code_ident\">Parent</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">string</span>[]&#xA0;<span class=\"code_ident\">Keys</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;}</code></div></td></tr></table><br>\r\nSpeciaal geval hierboven is de array van &apos;Keys&apos;. Dit zijn alle zoektermen waarop gezocht kan worden en waarin dit gebied terug moet komen. Denk hierbij bij &apos;Den Haag&apos; aan &apos;denhaag&apos; en &apos;haag&apos;. De reden dat we dit doen is omdat je altijd een <b>StartsWith</b> wil doen en geen <b>Substring</b>, omdat dat niet te indexen valt.<br>\r\n<br>\r\n<b>Gebieden vinden (StartsWith)!</b><br>\r\nGebieden vinden we op basis van hun Keys. Wanneer een bezoeker &apos;Amste&apos; intypt willen we alle gebieden vinden die een key hebben die begint met &apos;amste&apos;. Voor dit doel hebben we een index nodig; maar die is niet zo makkelijk te leggen. Daarom kies ik er hier voor om de index op de eerste twee karakters te leggen. Dit doen we voor elk element in de &apos;Keys&apos; array.<br>\r\n<br>index:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><pre>1\n2\n</pre></td><td class=\"phphighlightcode\"><div><pre>IxTwoChar[&apos;am&apos;] -&gt; &apos;amsterdam&apos;, &apos;amstelveen&apos;, &apos;amsterdamsestraatweg&apos; etc.\r\nIxTwoChar[&apos;ha&apos;] -&gt; &apos;den haag&apos;, &apos;hattemerbroek&apos;, etc.</pre></div></td></tr></table><br>\r\nWe kunnen hierdoor al snel 99,8% van alle mogelijkheden schrappen door alleen te kijken naar de eerste twee karakters. Er zitten per key zo&apos;n 600 entiteiten onder en die zijn in een duizendste van een seconde te doorzoeken.<br>\r\n<br>\r\nMorgen dieper de algoritmes in om effici&#xEB;nt gebieden te vinden waarbij de input volledig matcht, en op typfouten.",
    "nextLink": "http://glamour.tweakblogs.net/blog/5813/video%21-on-the-fly-zoeksuggesties-levenshtein-en-soundex-in-de-praktijk.html",
    "comments": [
        {
            "author": "jbdeiman",
            "date": "maandag 27 december 2010 15:30",
            "contentHtml": "Kan je hier niet iets van sql voor gebruiken met een SOUNDAS functionaliteit?",
            "ownReply": false
        },
        {
            "author": "Snikker",
            "date": "maandag 27 december 2010 15:33",
            "contentHtml": "Super dat je dit deelt, heel leerzaam!",
            "ownReply": false
        },
        {
            "author": "kipusoep",
            "date": "maandag 27 december 2010 15:42",
            "contentHtml": "Iehl, methoden en variabelen met Nederlandse namen  <img src=\"http://tweakimg.net/g/s/shutup.gif\" width=\"15\" height=\"16\" alt=\":X\">",
            "ownReply": false
        },
        {
            "author": "creator1988",
            "date": "maandag 27 december 2010 15:48",
            "contentHtml": "<blockquote><div class=\"quote\"><a href=\"http://glamour.tweakblogs.net/blog/5832/intelligente-suggesties-deel-1-introductie-en-startswith.html#r_78213\">jbdeiman schreef op maandag 27 december 2010 @ 15:30:</a><br>\r\nKan je hier niet iets van sql voor gebruiken met een SOUNDAS functionaliteit?</div></blockquote>Ja, alleen is die Engels en te traag om te gebruiken in deze situatie.<blockquote><div class=\"quote\"><a href=\"http://glamour.tweakblogs.net/blog/5832/intelligente-suggesties-deel-1-introductie-en-startswith.html#r_78215\">kipusoep schreef op maandag 27 december 2010 @ 15:42:</a><br>\r\nIehl, methoden en variabelen met Nederlandse namen  <img src=\"http://tweakimg.net/g/s/shutup.gif\" width=\"15\" height=\"16\" alt=\":X\"></div></blockquote>Iehl, mensen die geforceerd Engelse termen gaan gebruiken voor domeinspecifieke entiteiten  <img src=\"http://tweakimg.net/g/s/yummie.gif\" width=\"15\" height=\"15\" alt=\":9\">",
            "ownReply": true
        },
        {
            "author": "YopY",
            "date": "maandag 27 december 2010 15:52",
            "contentHtml": "Taalkundige zooi is nu niet heel erg domeinspecifiek, <img src=\"http://tweakimg.net/g/s/wink.gif\" width=\"15\" height=\"15\" alt=\";)\">.<br>\r\n<br>\r\nOverigens hoop ik - voor je eigen mentale gezondheid - dat die normalisatie en die index van eerste twee karakters niet allemaal hardcoded is.<br>\r\n<br>\r\nHoe staan die gegevens overigens in de database, en hoe wordt daarin met diakrieten omgegaan? bijvoorbeeld je hebt een dorpje &quot;d&#xFB;rp&quot;, je script normaliseert een invoer &quot;d&#xFB;rp&quot; naar &quot;durp&quot; zonder dakje. Wordt het dan nog gevonden?",
            "ownReply": false
        },
        {
            "author": "creator1988",
            "date": "maandag 27 december 2010 16:05",
            "contentHtml": "<blockquote><div class=\"quote\"><a href=\"http://glamour.tweakblogs.net/blog/5832/intelligente-suggesties-deel-1-introductie-en-startswith.html#r_78218\">YopY schreef op maandag 27 december 2010 @ 15:52:</a><br>\r\nOverigens hoop ik - voor je eigen mentale gezondheid - dat die normalisatie en die index van eerste twee karakters niet allemaal hardcoded is.<br>\r\n<br>\r\nHoe staan die gegevens overigens in de database, en hoe wordt daarin met diakrieten omgegaan? bijvoorbeeld je hebt een dorpje &quot;d&#xFB;rp&quot;, je script normaliseert een invoer &quot;d&#xFB;rp&quot; naar &quot;durp&quot; zonder dakje. Wordt het dan nog gevonden?</div></blockquote>Nee, bij een application startup trek ik alles uit de database, en sla het dan genormaliseerd op in memory. De database wordt niet meer geraakt na de eerste start. Bij het zoeken wordt dus alleen van de genormaliseerd index gebruik gemaakt. Zoiets:<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_ident\">IxTwoChar</span>[<span class=\"code_string\">&quot;wu&quot;</span>].<span class=\"code_method\">Where</span>(<span class=\"code_ident\">x</span>=&gt;<span class=\"code_ident\">x</span>.<span class=\"code_ident\">Keys</span>.<span class=\"code_method\">Any</span>(<span class=\"code_ident\">y</span>=&gt;<span class=\"code_ident\">y</span>.<span class=\"code_method\">StartsWith</span>(<span class=\"code_string\">&quot;wunsera&quot;</span>)));\n<br><span class=\"code_comment\">//&#xA0;Bij&#xA0;W&#xFB;nseradiel&#xA0;staat&#xA0;in&#xA0;de&#xA0;keys&#xA0;de&#xA0;key&#xA0;&apos;wunseradiel&apos;.</span></code></div></td></tr></table><p class=\"edit\">[Reactie gewijzigd op maandag 27 december 2010 16:06]</p>",
            "ownReply": true
        },
        {
            "author": "flowerp",
            "date": "maandag 27 december 2010 20:13",
            "contentHtml": "<blockquote><div class=\"quote\"><a href=\"http://glamour.tweakblogs.net/blog/5832/intelligente-suggesties-deel-1-introductie-en-startswith.html#r_78217\">creator1988 schreef op maandag 27 december 2010 @ 15:48:</a><br>\r\n[...]<br>\r\n<br>\r\nJa, alleen is die Engels en te traag om te gebruiken in deze situatie.<br>\r\n<br>\r\n<br>\r\n[...]<br>\r\n<br>\r\nIehl, mensen die geforceerd Engelse termen gaan gebruiken voor domeinspecifieke entiteiten  <img src=\"http://tweakimg.net/g/s/yummie.gif\" width=\"15\" height=\"15\" alt=\":9\"></div></blockquote>En toen ging je internationaal met je software, werd je software gekocht door een derde partij of kreeg je een sloot medewerkers van buiten Nederland...<br>\r\n<br>\r\nIn de 20+ jaar dat ik nu als developer bezig ben heb ik echt *zelden* de noodzaak gezien om een nationale taal te gebruiken in source code, zelfs voor entities (models). Er zijn heel af en toe uitzonderingen voor een begrip wat echt alleen voor een bepaald gebied bestaat en waar vertaling naar Engels zinloos zou zijn, maar dit zijn echt de uitzonderingen.<br>\r\n<br>\r\nIk hoop niet voor je dat je ooit nog eens in een team van een Japans bedrijf komt te werken dat dezelfde mentaliteit heeft als jij <img src=\"http://tweakimg.net/g/s/puh2.gif\" width=\"15\" height=\"15\" alt=\":P\"> Geloof me, dan stap je HEEL snel van je opvatting af dat entities in de taal moeten van het bedrijf dat begonnen is met de code.",
            "ownReply": false
        },
        {
            "author": "Bram®",
            "date": "maandag 27 december 2010 23:31",
            "contentHtml": "<blockquote><div class=\"quote\"><a href=\"http://glamour.tweakblogs.net/blog/5832/intelligente-suggesties-deel-1-introductie-en-startswith.html#r_78215\">kipusoep schreef op maandag 27 december 2010 @ 15:42:</a><br>\r\nIehl, methoden en variabelen met Nederlandse namen  <img src=\"http://tweakimg.net/g/s/shutup.gif\" width=\"15\" height=\"16\" alt=\":X\"></div></blockquote>Inderdaad, leest zo lekker weg:<blockquote><div class=\"quote\">private static Regex _alleenWordChar</div></blockquote>Maar het kan altijd nog een stapje erger. Een ex-werkgever (met de nadruk op ex <img src=\"http://tweakimg.net/g/s/emo.gif\" width=\"15\" height=\"15\" alt=\":&apos;)\">) deed ook het e.e.a. in het Nederlands: krijgVariabeleNaam() en zetVariabeleNaam().<br>\r\nOok heel praktisch als je dan Engelse documentatie moet lezen (en 99%+ van de documentatie waar het programmeertalen betreft is dat wel)  en je bent gewend in het &apos;Nederlands&apos; te programmeren.",
            "ownReply": false
        },
        {
            "author": "creator1988",
            "date": "dinsdag 28 december 2010 10:42",
            "contentHtml": "<blockquote><div class=\"quote\"><a href=\"http://glamour.tweakblogs.net/blog/5832/intelligente-suggesties-deel-1-introductie-en-startswith.html#r_78234\">flowerp schreef op maandag 27 december 2010 @ 20:13:</a><br>\r\nIn de 20+ jaar dat ik nu als developer bezig ben heb ik echt *zelden* de noodzaak gezien om een nationale taal te gebruiken in source code, zelfs voor entities (models). Er zijn heel af en toe uitzonderingen voor een begrip wat echt alleen voor een bepaald gebied bestaat en waar vertaling naar Engels zinloos zou zijn, maar dit zijn echt de uitzonderingen.</div></blockquote>Nou lijkt me niet. Ik kan wel alles gaan zitten vertalen, maar bijvoorbeeld de &apos;niveau&apos;s&apos; die we voor geografische entiteiten hebben zijn gewoon domeinspecifiek:<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br></code></td><td class=\"phphighlightcode\"><div><code>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">enum</span>&#xA0;<span class=\"code_ident\">Niveau</span>&#xA0;:&#xA0;<span class=\"code_keyword\">byte</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Buurt</span>&#xA0;=&#xA0;<span class=\"code_number\">2</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Gemeente</span>&#xA0;=&#xA0;<span class=\"code_number\">1</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Plaats</span>&#xA0;=&#xA0;<span class=\"code_number\">0</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Provincie</span>&#xA0;=&#xA0;<span class=\"code_number\">5</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Regio</span>&#xA0;=&#xA0;<span class=\"code_number\">3</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Straat</span>&#xA0;=&#xA0;<span class=\"code_number\">4</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Land</span>&#xA0;=&#xA0;<span class=\"code_number\">6</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;}</code></div></td></tr></table><blockquote><div class=\"quote\">Ik hoop niet voor je dat je ooit nog eens in een team van een Japans bedrijf komt te werken dat dezelfde mentaliteit heeft als jij <img src=\"http://tweakimg.net/g/s/puh2.gif\" width=\"15\" height=\"15\" alt=\":P\"> Geloof me, dan stap je HEEL snel van je opvatting af dat entities in de taal moeten van het bedrijf dat begonnen is met de code.</div></blockquote>Nee, niet alle entities moeten in dezelfde taal; maar de domeinspecifieke wel. Ik schrijf mijn code over het algemeen gewoon in het Engels; zeker generieke stukken. Geo is een domeinspecifiek onderdeel. Hoe ga je de VS geografisch weergeven in deze entities. Niet; want compleet anders.<blockquote><div class=\"quote\">Maar het kan altijd nog een stapje erger. Een ex-werkgever (met de nadruk op ex ) deed ook het e.e.a. in het Nederlands: krijgVariabeleNaam() en zetVariabeleNaam().<br>\r\nOok heel praktisch als je dan Engelse documentatie moet lezen (en 99%+ van de documentatie waar het programmeertalen betreft is dat wel) en je bent gewend in het &apos;Nederlands&apos; te programmeren.</div></blockquote>Ik vind absoluut dat je gewoon in het Engels moet schrijven, maar niet geforceerd.",
            "ownReply": true
        },
        {
            "author": "beeman",
            "date": "woensdag 29 december 2010 17:20",
            "contentHtml": "@creator1988 Goeie serie, en hij komt precies op het juiste moment voor mij <img src=\"http://tweakimg.net/g/s/smile.gif\" width=\"15\" height=\"15\" alt=\":)\"><br>\r\n<br>\r\nVoor de mensen die op zoek zijn naar lijsten met plaatsnamen en dergelijke:<ul><li><a href=\"http://kvdb.net/projects/6pp/\" rel=\"external\" title=\"http://kvdb.net/projects/6pp/\">http://kvdb.net/projects/6pp/</a> Nederland</li><li><a href=\"http://www.geonames.org/\" rel=\"external\" title=\"http://www.geonames.org/\">http://www.geonames.org/</a> Wereldwijd</li></ul>",
            "ownReply": false
        }
    ]
}