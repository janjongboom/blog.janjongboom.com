{
    "title": "Zoekscherm dat dynamisch queries maakt met Expression Trees en MVC",
    "language": "nl",
    "link": "http://glamour.tweakblogs.net/blog/6183/zoekscherm-dat-dynamisch-queries-maakt-met-expression-trees-en-mvc.html",
    "date": "2011-02-23T13:39:00.000Z",
    "category": "Frontend",
    "views": 3560,
    "articleHtml": "Naar aanleiding van de reactie van Jogai in <a href=\"http://glamour.tweakblogs.net/blog/6174/route-constraints-op-querystring-parameters-in-asp-punt-net-mvc.html\" rel=\"external\">Coding Glamour: Route constraints op QueryString parameters in ASP.NET MVC</a>, een post over het mappen van een MVC zoekformulier naar een echte SQL query.<br>\r\n<br>\r\n<b>Let&apos;s get it started</b><br>\r\nMet behulp van het volgende model wordt een view getoond met daarop een formulier:<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_comment\">//&#xA0;model</span>\n<br><span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">class</span>&#xA0;<span class=\"code_ident\">ZoekformulierModel</span>&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">Plaatsnaam</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">int</span>&#xA0;<span class=\"code_ident\">PrijsVan</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">int</span>&#xA0;<span class=\"code_ident\">PrijsTot</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">bool</span>&#xA0;<span class=\"code_ident\">IndTuin</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">/*&#xA0;wat&#xA0;code&#xA0;voor&#xA0;de&#xA0;opties&#xA0;in&#xA0;de&#xA0;selectlist&#xA0;*/</span>\n<br>}</code></div></td></tr></table><br>\r\n<br>HTML:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_special\">&lt;!</span><span class=\"code_comment\">--&#xA0;view&#xA0;--</span><span class=\"code_special\">&gt;</span>\n<br><span class=\"code_ident\">&lt;form</span>&#xA0;<span class=\"code_method\">method</span>=<span class=\"code_string\">&quot;post&quot;</span>&#xA0;<span class=\"code_method\">action</span>=<span class=\"code_string\">&quot;</span><span class=\"code_string\">&quot;</span><span class=\"code_ident\">&gt;</span>\n<br><span class=\"code_ident\">&lt;h1</span><span class=\"code_ident\">&gt;</span>Zoekformulier<span class=\"code_ident\">&lt;/h1</span><span class=\"code_ident\">&gt;</span>\n<br><span class=\"code_ident\">&lt;table</span><span class=\"code_ident\">&gt;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">&lt;tr</span><span class=\"code_ident\">&gt;</span><span class=\"code_ident\">&lt;th</span><span class=\"code_ident\">&gt;</span>Plaats<span class=\"code_ident\">&lt;/th</span><span class=\"code_ident\">&gt;</span><span class=\"code_ident\">&lt;td</span><span class=\"code_ident\">&gt;</span>&lt;%=Html.TextBoxFor(m=&gt;m.Plaatsnaam)&#xA0;%&gt;<span class=\"code_ident\">&lt;/td</span><span class=\"code_ident\">&gt;</span><span class=\"code_ident\">&lt;/tr</span><span class=\"code_ident\">&gt;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">&lt;tr</span><span class=\"code_ident\">&gt;</span><span class=\"code_ident\">&lt;th</span><span class=\"code_ident\">&gt;</span>Prijs<span class=\"code_ident\">&lt;/th</span><span class=\"code_ident\">&gt;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">&lt;td</span><span class=\"code_ident\">&gt;</span>&lt;%=Html.DropDownListFor(m=&gt;m.PrijsVan,&#xA0;Model.PrijsRange)&#xA0;%&gt;&#xA0;-&#xA0;&lt;%=Html.DropDownListFor(m=&gt;m.PrijsTot,&#xA0;Model.PrijsRange)&#xA0;%&gt;<span class=\"code_ident\">&lt;/td</span><span class=\"code_ident\">&gt;</span><span class=\"code_ident\">&lt;/tr</span><span class=\"code_ident\">&gt;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">&lt;tr</span><span class=\"code_ident\">&gt;</span><span class=\"code_ident\">&lt;th</span><span class=\"code_ident\">&gt;</span>Tuin?<span class=\"code_ident\">&lt;/th</span><span class=\"code_ident\">&gt;</span><span class=\"code_ident\">&lt;td</span><span class=\"code_ident\">&gt;</span>&lt;%=Html.CheckBoxFor(m=&gt;m.IndTuin)&#xA0;%&gt;<span class=\"code_ident\">&lt;/td</span><span class=\"code_ident\">&gt;</span><span class=\"code_ident\">&lt;/tr</span><span class=\"code_ident\">&gt;</span>\n<br><span class=\"code_ident\">&lt;/table</span><span class=\"code_ident\">&gt;</span>\n<br><span class=\"code_ident\">&lt;input</span>&#xA0;<span class=\"code_method\">type</span>=<span class=\"code_string\">&quot;submit&quot;</span>&#xA0;<span class=\"code_method\">value</span>=<span class=\"code_string\">&quot;</span><span class=\"code_string\">Zoeken</span><span class=\"code_string\">&quot;</span>&#xA0;<span class=\"code_special\">/</span><span class=\"code_ident_unknown\">&gt;</span>\n<br><span class=\"code_ident\">&lt;/form</span><span class=\"code_ident\">&gt;</span></code></div></td></tr></table><br>\r\n<img src=\"http://www.100procentjan.nl/tweakers/zoek1.png\" title=\"http://www.100procentjan.nl/tweakers/zoek1.png\" alt=\"http://www.100procentjan.nl/tweakers/zoek1.png\"><br><a name=\"more\"></a><br>\r\n<b>Verwerken van de invoer</b><br>\r\nNa klikken op submit krijgen we in onze actie het gevulde formulier binnen:<br>\r\n<img src=\"http://www.100procentjan.nl/tweakers/zoek2.png\" title=\"http://www.100procentjan.nl/tweakers/zoek2.png\" alt=\"http://www.100procentjan.nl/tweakers/zoek2.png\"><br>\r\n<br>\r\nHoe vertalen we nu het model naar een IQueryable&lt;&gt; van je data entities?<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_comment\">//&#xA0;data&#xA0;entity</span>\n<br><span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">class</span>&#xA0;<span class=\"code_ident\">ZoekKoop</span>&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">woonplaats</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">int</span>&#xA0;<span class=\"code_ident\">koopprijs</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">bool</span>&#xA0;<span class=\"code_ident\">indTuin</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>}</code></div></td></tr></table><br>\r\n<br>\r\nJe zou een &apos;if-else&apos; constructie kunnen schrijven:<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_keyword\">using</span>(<span class=\"code_ident\">DPLDataContext</span>&#xA0;<span class=\"code_ident\">dc</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">DPLDataContext</span>())\n<br>{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">IQueryable</span>&lt;<span class=\"code_ident\">ZoekKoop</span>&gt;&#xA0;<span class=\"code_ident\">query</span>&#xA0;=&#xA0;<span class=\"code_ident\">dc</span>.<span class=\"code_ident\">ZoekKoop</span>.<span class=\"code_method\">AsQueryable</span>();\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">if</span>(!<span class=\"code_keyword\">string</span>.<span class=\"code_method\">IsNullOrEmpty</span>(<span class=\"code_ident\">model</span>.<span class=\"code_ident\">Plaatsnaam</span>))\n<br>&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">query</span>&#xA0;=&#xA0;<span class=\"code_ident\">query</span>.<span class=\"code_method\">Where</span>(<span class=\"code_ident\">q</span>&#xA0;=&gt;&#xA0;<span class=\"code_ident\">q</span>.<span class=\"code_ident\">woonplaats</span>&#xA0;==&#xA0;<span class=\"code_ident\">model</span>.<span class=\"code_ident\">Plaatsnaam</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;execute&#xA0;query</span>\n<br>}</code></div></td></tr></table><br>\r\n<b>Maar...</b> veel werk, en niet dynamisch. Dat kan beters!<br>\r\n<br>\r\n<b>Mapper schrijven</b><br>\r\nErgens zullen we moeten bijhouden welk veld in het model correleert met een veld in je data-entity, en op welke manier. Omdat niet alle velden werken volgens &apos;IsEqual&apos;; maar er bijvoorbeeld ranges zijn (zoals PrijsVan - PrijsTot) kunnen we slim gebruik maken van &apos;ExpressionType&apos;.<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">class</span>&#xA0;<span class=\"code_ident\">MappingItem</span>\n<br>{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_ident\">Expression</span>&lt;<span class=\"code_ident\">Func</span>&lt;<span class=\"code_ident\">ZoekformulierModel</span>,&#xA0;<span class=\"code_keyword\">object</span>&#xA0;&gt;&gt;&#xA0;<span class=\"code_ident\">ModelParameter</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_ident\">Expression</span>&lt;<span class=\"code_ident\">Func</span>&lt;<span class=\"code_ident\">ZoekKoop</span>,&#xA0;<span class=\"code_keyword\">object</span>&gt;&gt;&#xA0;<span class=\"code_ident\">DataParameter</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_ident\">ExpressionType</span>&#xA0;<span class=\"code_ident\">Expression</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_method\">MappingItem</span>(<span class=\"code_ident\">Expression</span>&lt;<span class=\"code_ident\">Func</span>&lt;<span class=\"code_ident\">ZoekformulierModel</span>,&#xA0;<span class=\"code_keyword\">object</span>&gt;&gt;&#xA0;<span class=\"code_ident\">modelParameter</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Expression</span>&lt;<span class=\"code_ident\">Func</span>&lt;<span class=\"code_ident\">ZoekKoop</span>,&#xA0;<span class=\"code_keyword\">object</span>&gt;&gt;&#xA0;<span class=\"code_ident\">dataParameter</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">ExpressionType</span>&#xA0;<span class=\"code_ident\">expression</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">ModelParameter</span>&#xA0;=&#xA0;<span class=\"code_ident\">modelParameter</span>;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">DataParameter</span>&#xA0;=&#xA0;<span class=\"code_ident\">dataParameter</span>;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Expression</span>&#xA0;=&#xA0;<span class=\"code_ident\">expression</span>;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>}</code></div></td></tr></table><br>\r\nNu kunnen we mapping aangeven:<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_ident\">List</span>&lt;<span class=\"code_ident\">MappingItem</span>&gt;&#xA0;<span class=\"code_ident\">mapping</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_ident\">List</span>&lt;<span class=\"code_ident\">MappingItem</span>&gt;()\n<br>&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">MappingItem</span>(<span class=\"code_ident\">m</span>=&gt;<span class=\"code_ident\">m</span>.<span class=\"code_ident\">Plaatsnaam</span>,&#xA0;<span class=\"code_ident\">d</span>=&gt;<span class=\"code_ident\">d</span>.<span class=\"code_ident\">woonplaats</span>,&#xA0;<span class=\"code_ident\">ExpressionType</span>.<span class=\"code_ident\">Equal</span>),\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">MappingItem</span>(<span class=\"code_ident\">m</span>=&gt;<span class=\"code_ident\">m</span>.<span class=\"code_ident\">PrijsVan</span>,&#xA0;<span class=\"code_ident\">d</span>=&gt;<span class=\"code_ident\">d</span>.<span class=\"code_ident\">koopprijs</span>,&#xA0;<span class=\"code_ident\">ExpressionType</span>.<span class=\"code_ident\">GreaterThanOrEqual</span>),\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">MappingItem</span>(<span class=\"code_ident\">m</span>=&gt;<span class=\"code_ident\">m</span>.<span class=\"code_ident\">PrijsTot</span>,&#xA0;<span class=\"code_ident\">d</span>=&gt;<span class=\"code_ident\">d</span>.<span class=\"code_ident\">koopprijs</span>,&#xA0;<span class=\"code_ident\">ExpressionType</span>.<span class=\"code_ident\">LessThanOrEqual</span>),\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">MappingItem</span>(<span class=\"code_ident\">m</span>=&gt;<span class=\"code_ident\">m</span>.<span class=\"code_ident\">IndTuin</span>,&#xA0;<span class=\"code_ident\">d</span>=&gt;<span class=\"code_ident\">d</span>.<span class=\"code_ident\">indTuin</span>,&#xA0;<span class=\"code_ident\">ExpressionType</span>.<span class=\"code_ident\">Equal</span>),\n<br>&#xA0;&#xA0;&#xA0;&#xA0;};</code></div></td></tr></table><br>\r\nWe weten nu welke velden bij elkaar horen; en we hebben deze bovendien in een Expression Tree zitten. Dat betekent dat de informatie niet verloren gaat, of weggeoptimaliseerd worden tidjens compilation, maar dat we er nog iets mee kunnen doen.<br>\r\n<br>\r\n<b>Van expression tree naar IQueryable</b><br>\r\nLet&apos;s code!<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_keyword\">using</span>&#xA0;(<span class=\"code_ident\">DPLDataContext</span>&#xA0;<span class=\"code_ident\">dc</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">DPLDataContext</span>())\n<br>{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;AsQueryable&#xA0;basis&#xA0;aanmaken</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">IQueryable</span>&lt;<span class=\"code_ident\">ZoekKoop</span>&gt;&#xA0;<span class=\"code_ident\">query</span>&#xA0;=&#xA0;<span class=\"code_ident\">dc</span>.<span class=\"code_ident\">Funda_ZOEK_Koops</span>.<span class=\"code_method\">AsQueryable</span>();\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;iterate&#xA0;over&#xA0;each&#xA0;mapping</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">foreach</span>&#xA0;(<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">item</span>&#xA0;<span class=\"code_keyword\">in</span>&#xA0;<span class=\"code_ident\">mapping</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;grab&#xA0;the&#xA0;value&#xA0;from&#xA0;the&#xA0;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">valueFromModel</span>&#xA0;=&#xA0;<span class=\"code_ident\">item</span>.<span class=\"code_ident\">ModelParameter</span>.<span class=\"code_method\">Compile</span>().<span class=\"code_method\">Invoke</span>(<span class=\"code_ident\">model</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">if</span>(<span class=\"code_ident\">valueFromModel</span>&#xA0;==&#xA0;<span class=\"code_keyword\">null</span>)&#xA0;<span class=\"code_keyword\">continue</span>;\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;bepaal&#xA0;de&#xA0;default&#xA0;waarde&#xA0;van&#xA0;het&#xA0;type</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;je&#xA0;kan&#xA0;hier&#xA0;extra&#xA0;checks&#xA0;op&#xA0;doen,&#xA0;zoals:</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;(valueFromModel&#xA0;is&#xA0;Int32&#xA0;&amp;&amp;&#xA0;((Int32)valueFromModel)&#xA0;!=&#xA0;Int32.Max)</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;voor&#xA0;de&#xA0;max&#xA0;waarde&#xA0;van&#xA0;dingen</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">type</span>&#xA0;=&#xA0;<span class=\"code_ident\">valueFromModel</span>.<span class=\"code_method\">GetType</span>();\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">if</span>&#xA0;(!<span class=\"code_ident\">valueFromModel</span>.<span class=\"code_method\">Equals</span>(<span class=\"code_ident\">type</span>.<span class=\"code_ident\">IsValueType</span>&#xA0;?&#xA0;<span class=\"code_ident\">Activator</span>.<span class=\"code_method\">CreateInstance</span>(<span class=\"code_ident\">type</span>)&#xA0;:&#xA0;<span class=\"code_keyword\">null</span>))\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;we&#xA0;gaan&#xA0;nu&#xA0;de&#xA0;IQueryable&#xA0;opbouwen</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;hiervoor&#xA0;is&#xA0;nodig:</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;-&#xA0;het&#xA0;type&#xA0;van&#xA0;het&#xA0;object&#xA0;zoals&#xA0;in&#xA0;de&#xA0;data</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;deze&#xA0;zit&#xA0;verborgen...</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">MemberExpression</span>&#xA0;<span class=\"code_ident\">memberAccessExpression</span>;\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">bodyExpression</span>&#xA0;=&#xA0;<span class=\"code_ident\">item</span>.<span class=\"code_ident\">DataParameter</span>.<span class=\"code_ident\">Body</span>;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">if</span>(<span class=\"code_ident\">bodyExpression</span>&#xA0;<span class=\"code_keyword\">is</span>&#xA0;<span class=\"code_ident\">UnaryExpression</span>)&#xA0;<span class=\"code_comment\">//&#xA0;bij&#xA0;impliciete&#xA0;conversie</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">memberAccessExpression</span>&#xA0;=&#xA0;((<span class=\"code_ident\">MemberExpression</span>)&#xA0;((<span class=\"code_ident\">UnaryExpression</span>)&#xA0;<span class=\"code_ident\">bodyExpression</span>).<span class=\"code_ident\">Operand</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">else</span>&#xA0;<span class=\"code_keyword\">if</span>(<span class=\"code_ident\">bodyExpression</span>&#xA0;<span class=\"code_keyword\">is</span>&#xA0;<span class=\"code_ident\">MemberExpression</span>)&#xA0;<span class=\"code_comment\">//&#xA0;bij&#xA0;direct&#xA0;aanroepen</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">memberAccessExpression</span>&#xA0;=&#xA0;((<span class=\"code_ident\">MemberExpression</span>)<span class=\"code_ident\">bodyExpression</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">else</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">throw</span>&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">Exception</span>(<span class=\"code_string\">&quot;Unexpected&#xA0;expression&#xA0;type&quot;</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;maak&#xA0;een&#xA0;parameter&#xA0;aan&#xA0;voor&#xA0;de&#xA0;expression,&#xA0;zodat&#xA0;we&#xA0;ook&#xA0;met&#xA0;een&#xA0;object&#xA0;kunnen&#xA0;werken</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">ParameterExpression</span>&#xA0;<span class=\"code_ident\">parameter</span>&#xA0;=&#xA0;(<span class=\"code_ident\">ParameterExpression</span>)<span class=\"code_ident\">Expression</span>.<span class=\"code_method\">Parameter</span>(<span class=\"code_keyword\">typeof</span>(<span class=\"code_ident\">ZoekKoop</span>),&#xA0;<span class=\"code_string\">&quot;s&quot;</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;maak&#xA0;een&#xA0;vergelijking&#xA0;met&#xA0;als&#xA0;type&#xA0;&apos;Expression&apos;,&#xA0;en&#xA0;maak&#xA0;deze&#xA0;tussen</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;parameter&#xA0;&amp;&#xA0;valueFromModel</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Expression</span>&#xA0;<span class=\"code_ident\">expr</span>&#xA0;=&#xA0;<span class=\"code_ident\">Expression</span>.<span class=\"code_method\">MakeBinary</span>(<span class=\"code_ident\">item</span>.<span class=\"code_ident\">Expression</span>,&#xA0;<span class=\"code_ident\">Expression</span>.<span class=\"code_method\">MakeMemberAccess</span>(<span class=\"code_ident\">parameter</span>,&#xA0;<span class=\"code_ident\">memberAccessExpression</span>.<span class=\"code_ident\">Member</span>),&#xA0;<span class=\"code_ident\">Expression</span>.<span class=\"code_method\">Constant</span>(<span class=\"code_ident\">valueFromModel</span>));\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;bouw&#xA0;de&#xA0;predicate&#xA0;op&#xA0;basis&#xA0;van&#xA0;bovenstaande&#xA0;expressions</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">predicate</span>&#xA0;=&#xA0;(<span class=\"code_ident\">Expression</span>&lt;<span class=\"code_ident\">Func</span>&lt;<span class=\"code_ident\">ZoekKoop</span>,&#xA0;<span class=\"code_keyword\">bool</span>&gt;&gt;)(<span class=\"code_ident\">Expression</span>.<span class=\"code_method\">Lambda</span>(<span class=\"code_ident\">expr</span>,&#xA0;<span class=\"code_ident\">parameter</span>));\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;en&#xA0;pas&#xA0;deze&#xA0;toe</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">query</span>&#xA0;=&#xA0;<span class=\"code_ident\">query</span>.<span class=\"code_method\">Where</span>(<span class=\"code_ident\">predicate</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;om&#xA0;te&#xA0;controleren!</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">tsql</span>&#xA0;=&#xA0;<span class=\"code_ident\">query</span>.<span class=\"code_method\">ToString</span>();\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;resultaat&#xA0;fetchen</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">res</span>&#xA0;=&#xA0;<span class=\"code_ident\">query</span>.<span class=\"code_method\">ToList</span>();\n<br>}</code></div></td></tr></table><br>\r\n<br>\r\n<b>En? Werkt het?</b><br>\r\nAfhankelijk van onze invoer wordt nu de query gebakken; te controleren via de &apos;tsql&apos; string:<br>\r\n<img src=\"http://www.100procentjan.nl/tweakers/zoek3.png\" title=\"http://www.100procentjan.nl/tweakers/zoek3.png\" alt=\"http://www.100procentjan.nl/tweakers/zoek3.png\"><br>\r\n<br>\r\nVullen we nu velden niet in; dan worden deze ook niet meegenomen in de WHERE clause:<br>\r\n<img src=\"http://www.100procentjan.nl/tweakers/zoek4.png\" title=\"http://www.100procentjan.nl/tweakers/zoek4.png\" alt=\"http://www.100procentjan.nl/tweakers/zoek4.png\"><br>\r\n<br>\r\nAwesomness.",
    "nextLink": "http://glamour.tweakblogs.net/blog/6174/route-constraints-op-querystring-parameters-in-asp-punt-net-mvc.html",
    "comments": [
        {
            "author": "Jogai",
            "date": "woensdag 23 februari 2011 15:03",
            "contentHtml": "Thanx man! Ik heb het nu idd met if-else constructies gedaan. Project is zowat voorbij dus ik laat het nu zo, maar dit ga ik zeker een keer toepassen.<br>\r\nJij mapt nu je ZoekformulierModel tegen je Form, maar hoe map je dan je resultaten? Je hebt toch maar 1  ViewData.Model die je juist voor resultaten gebruikt?",
            "ownReply": false
        },
        {
            "author": "creator1988",
            "date": "woensdag 23 februari 2011 15:16",
            "contentHtml": "<blockquote><div class=\"quote\"><a href=\"http://glamour.tweakblogs.net/blog/6183/zoekscherm-dat-dynamisch-queries-maakt-met-expression-trees-en-mvc.html#r_83168\">Jogai schreef op woensdag 23 februari 2011 @ 15:03:</a><br>\r\nThanx man! Ik heb het nu idd met if-else constructies gedaan. Project is zowat voorbij dus ik laat het nu zo, maar dit ga ik zeker een keer toepassen.<br>\r\nJij mapt nu je ZoekformulierModel tegen je Form, maar hoe map je dan je resultaten? Je hebt toch maar 1  ViewData.Model die je juist voor resultaten gebruikt?</div></blockquote>Nee, je maakt zoveel Models als je zelf nodig hebt (per type scherm &#xE9;&#xE9;n). In dit geval zou mijn code er ongeveer zo uit zien:<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_comment\">//&#xA0;model</span>\n<br><span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">class</span>&#xA0;<span class=\"code_ident\">ResultaatlijstModel</span>&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">class</span>&#xA0;<span class=\"code_ident\">ResultaatlijstItem</span>&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">Plaats</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">int</span>&#xA0;<span class=\"code_ident\">Prijs</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">bool</span>&#xA0;<span class=\"code_ident\">IndTuin</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_ident\">List</span>&lt;<span class=\"code_ident\">ResultaatlijstItem</span>&gt;&#xA0;<span class=\"code_ident\">Items</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>}\n<br>\n<br><span class=\"code_comment\">//&#xA0;de&#xA0;POST&#xA0;actie&#xA0;van&#xA0;je&#xA0;formulier</span>\n<br>[<span class=\"code_ident\">HttpPost</span>]\n<br><span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_ident\">ActionResult</span>&#xA0;<span class=\"code_method\">Index</span>(<span class=\"code_ident\">ZoekformulierModel</span>&#xA0;<span class=\"code_ident\">model</span>)&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">resultSet</span>&#xA0;=&#xA0;<span class=\"code_method\">HaalUitDatabaseOpModelGebaseerd</span>(<span class=\"code_ident\">model</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;bedoeling&#xA0;is&#xA0;nu&#xA0;dat&#xA0;we&#xA0;gaan&#xA0;mappen&#xA0;van&#xA0;de&#xA0;resultaten&#xA0;in&#xA0;DB&#xA0;-&gt;&#xA0;ResultaatlijstModel</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">resultModel</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_ident\">ResultaatlijstModel</span>&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;dit&#xA0;is&#xA0;je&#xA0;&apos;map&apos;&#xA0;functie</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Items</span>&#xA0;=&#xA0;<span class=\"code_ident\">resultSet</span>.<span class=\"code_method\">Select</span>(<span class=\"code_ident\">i</span>&#xA0;=&gt;&#xA0;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_ident\">ResultaatlijstItem</span>&#xA0;{&#xA0;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Plaats</span>&#xA0;=&#xA0;<span class=\"code_ident\">i</span>.<span class=\"code_ident\">woonplaats</span>,&#xA0;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Prijs</span>&#xA0;=&#xA0;<span class=\"code_ident\">i</span>.<span class=\"code_ident\">koopprijs</span>,&#xA0;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">IndTuin</span>&#xA0;=&#xA0;<span class=\"code_ident\">i</span>.<span class=\"code_ident\">indTuin</span>&#xA0;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}).<span class=\"code_method\">ToList</span>()\n<br>&#xA0;&#xA0;&#xA0;&#xA0;};\n<br>&#xA0;&#xA0;&#xA0;&#xA0;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;retouneer&#xA0;nu&#xA0;je&#xA0;Resultaatlijst.ascx&#xA0;view</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">return</span>&#xA0;<span class=\"code_method\">View</span>(<span class=\"code_string\">&quot;~/Views/Resultaatlijst.ascx&quot;</span>,&#xA0;<span class=\"code_ident\">resultModel</span>);\n<br>}</code></div></td></tr></table><br>\r\n<br>\r\nIn je resultaatlijst krijg je nu een &apos;ResultaatlijstModel&apos; terug met daarin de resultaten.",
            "ownReply": true
        },
        {
            "author": "Jogai",
            "date": "woensdag 23 februari 2011 15:51",
            "contentHtml": "Maar nu wil je eigenlijk je zoekformulier weer mappen op ZoekformulierModel zodat de waardes waarop je gezocht hebt nog steeds in je formulier zichtbaar zijn.",
            "ownReply": false
        },
        {
            "author": "creator1988",
            "date": "woensdag 23 februari 2011 16:09",
            "contentHtml": "<blockquote><div class=\"quote\"><a href=\"http://glamour.tweakblogs.net/blog/6183/zoekscherm-dat-dynamisch-queries-maakt-met-expression-trees-en-mvc.html#r_83171\">Jogai schreef op woensdag 23 februari 2011 @ 15:51:</a><br>\r\nMaar nu wil je eigenlijk je zoekformulier weer mappen op ZoekformulierModel zodat de waardes waarop je gezocht hebt nog steeds in je formulier zichtbaar zijn.</div></blockquote>Je zal de waarde van je ZoekformulierModel op moeten slaan ergens (serialized) om deze weer terug te kunnen zetten. Je kan niet van query -&gt; formulier, als je bijv. met ranges werkt. Je weet niet wat de gebruiker origineel heeft ingevoerd.<br>\r\n<br>\r\nBij funda gebruiken we de volgende techniek:<br>\r\n<br>\r\nGebruiker voert in -&gt; Wordt opgeslagen als serialized string in friendly URL formaat (/koop/amsterdam/0-500000/tuin/ bijvoorbeeld) -&gt; Resultaatlijst met als URL de friendly URL -&gt; zet om naar query. Als je weer op &apos;zoeken&apos; klikt, krijg je de URL mee; en die kan direct worden omgezet naar een zoekformulier.",
            "ownReply": true
        },
        {
            "author": "RobIII",
            "date": "vrijdag 25 februari 2011 00:55",
            "contentHtml": "Dit is niet helemaal mijn &quot;hoekje&quot; maar is een <a href=\"http://www.albahari.com/nutshell/predicatebuilder.aspx\" rel=\"external\">PredicateBuilder</a> hier niet handig(er) voor? Ik kwam ook <a href=\"http://smehrozalam.wordpress.com/2010/04/06/linq-how-to-build-complex-queries-utilizing-deferred-execution-and-anonymous-types/\" rel=\"external\">dit</a> nog tegen...<br>\r\n<br>\r\nWat ik w&#xE9;l vaker in &quot;plain ol&apos; SQL&quot; doe is iets als volgt:<br>\r\n<br>SQL:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_keyword\">select</span>&#xA0;<span class=\"code_ident\">foo</span>,&#xA0;<span class=\"code_ident\">bar</span>,&#xA0;<span class=\"code_ident\">foobar</span>,&#xA0;...\n<br><span class=\"code_keyword\">from</span>&#xA0;<span class=\"code_ident\">sometable</span>\n<br><span class=\"code_method\">where</span>&#xA0;((<span class=\"code_ident\">@pricestart</span>&#xA0;<span class=\"code_keyword\">is</span>&#xA0;<span class=\"code_keyword\">null</span>)&#xA0;<span class=\"code_method\">or</span>&#xA0;(<span class=\"code_ident\">price</span>&#xA0;&gt;=&#xA0;<span class=\"code_ident\">@pricestart</span>))\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_method\">and</span>&#xA0;((<span class=\"code_ident\">@priceend</span>&#xA0;<span class=\"code_keyword\">is</span>&#xA0;<span class=\"code_keyword\">null</span>)&#xA0;<span class=\"code_method\">or</span>&#xA0;(<span class=\"code_ident\">price</span>&#xA0;&lt;=&#xA0;<span class=\"code_ident\">@priceend</span>))\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_method\">and</span>&#xA0;((<span class=\"code_ident\">@city</span>&#xA0;<span class=\"code_keyword\">is</span>&#xA0;<span class=\"code_keyword\">null</span>)&#xA0;<span class=\"code_method\">or</span>&#xA0;(<span class=\"code_ident\">city</span>&#xA0;<span class=\"code_keyword\">like</span>&#xA0;<span class=\"code_ident\">city</span>&#xA0;+&#xA0;<span class=\"code_string\">&apos;%&apos;</span>))\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_method\">and</span>&#xA0;((<span class=\"code_ident\">@garden</span>&#xA0;<span class=\"code_keyword\">is</span>&#xA0;<span class=\"code_keyword\">null</span>)&#xA0;<span class=\"code_method\">or</span>&#xA0;(<span class=\"code_ident\">garden</span>&#xA0;=&#xA0;<span class=\"code_ident\">@garden</span>))\n<br><span class=\"code_keyword\">order</span>&#xA0;<span class=\"code_keyword\">by</span>&#xA0;...</code></div></td></tr></table><br>\r\nAls je dan voor eender welke parameter (@pricestart, @priceend, @city, @garden) een NULL passed dan zal de query optimizer de hele expression wegoptimaliseren; geef je een waarde voor een parameter dan wordt &apos;ie meegenomen.<br>\r\n<br>\r\nOver het algemeen voor de simpele(re) zaken werkt dit best goed <img src=\"http://tweakimg.net/g/s/puh2.gif\" width=\"15\" height=\"15\" alt=\":P\"><p class=\"edit\">[Reactie gewijzigd op vrijdag 25 februari 2011 08:21]</p>",
            "ownReply": false
        }
    ]
}