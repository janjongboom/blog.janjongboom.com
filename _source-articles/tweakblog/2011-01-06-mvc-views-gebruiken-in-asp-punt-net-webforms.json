{
    "title": "MVC Views gebruiken in ASP.NET Webforms",
    "language": "nl",
    "link": "http://glamour.tweakblogs.net/blog/5902/mvc-views-gebruiken-in-asp-punt-net-webforms.html",
    "date": "2011-01-06T12:51:00.000Z",
    "category": "Frontend",
    "views": 2539,
    "articleHtml": "Wanneer je een hybride website hebt, waarin zowel MVC als Webforms gebruikt worden; een niet ongewoon scenario wanneer je website constant in development is; kan het gebeuren dat je veelgebruikte controls (zoals bijvoorbeeld een &apos;Login&apos; control) in Webforms schrijft omdat je ze dan voor allebei de architecturen kan gebruiken.<br>\r\n<br>\r\nVandaar het &apos;ViewRenderer&apos; control, een CustomControl dat MVC Views kan renderen in Webforms controls. Syntax?<br>\r\n<br>ASP.NET:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><pre>1\n</pre></td><td class=\"phphighlightcode\"><div><pre>&lt;Mvc:ViewControl runat=&quot;server&quot; ViewName=&quot;~/Views/Shared/Login.ascx&quot;/&gt;</pre></div></td></tr></table><br><a name=\"more\"></a><br>\r\n<b>Views renderen</b><br>\r\nOm dit te bouwen, moeten we de output van de view kunnen renderen naar een string; die we vervolgens weer kunnen neerzetten op de Webforms pagina. In MVC 1 is hier een probleem omdat de &apos;HtmlHelper.RenderPartial&apos; naar de HttpContext schrijft. Hier is omheen te werken:<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_comment\">///&#xA0;&lt;summary&gt;</span>\n<br><span class=\"code_comment\">///&#xA0;See&#xA0;http://www.klopfenstein.net/lorenz.aspx/render-partial-view-to-string-in-asp-net-mvc</span>\n<br><span class=\"code_comment\">///&#xA0;based&#xA0;on&#xA0;http://stackoverflow.com/questions/483091/render-a-view-as-a-string</span>\n<br><span class=\"code_comment\">///&#xA0;&lt;/summary&gt;</span>\n<br><span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">static</span>&#xA0;<span class=\"code_keyword\">class</span>&#xA0;<span class=\"code_ident\">RenderPartialViewHelper</span>\n<br>{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">///&#xA0;&lt;summary&gt;Renders&#xA0;a&#xA0;view&#xA0;to&#xA0;string.&lt;/summary&gt;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">static</span>&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_method\">RenderViewToString</span>(<span class=\"code_keyword\">this</span>&#xA0;<span class=\"code_ident\">Controller</span>&#xA0;<span class=\"code_ident\">controller</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">viewName</span>,&#xA0;<span class=\"code_keyword\">object</span>&#xA0;<span class=\"code_ident\">viewData</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//Create&#xA0;memory&#xA0;writer&#xA0;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">sb</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">StringBuilder</span>();\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">memWriter</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">StringWriter</span>(<span class=\"code_ident\">sb</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;Set&#xA0;some&#xA0;defaults</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">controller</span>.<span class=\"code_ident\">ControllerContext</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">ControllerContext</span>();\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">controller</span>.<span class=\"code_ident\">ControllerContext</span>.<span class=\"code_ident\">Controller</span>&#xA0;=&#xA0;<span class=\"code_ident\">controller</span>;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">controller</span>.<span class=\"code_ident\">ControllerContext</span>.<span class=\"code_ident\">RouteData</span>.<span class=\"code_ident\">Values</span>.<span class=\"code_method\">Add</span>(<span class=\"code_string\">&quot;controller&quot;</span>,&#xA0;<span class=\"code_ident\">controller</span>.<span class=\"code_method\">GetType</span>().<span class=\"code_ident\">Name</span>.<span class=\"code_method\">Replace</span>(<span class=\"code_string\">&quot;Controller&quot;</span>,&#xA0;<span class=\"code_string\">&quot;&quot;</span>));\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//Create&#xA0;fake&#xA0;http&#xA0;context&#xA0;to&#xA0;render&#xA0;the&#xA0;view&#xA0;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">fakeResponse</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">HttpResponse</span>(<span class=\"code_ident\">memWriter</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">fakeContext</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">HttpContext</span>(<span class=\"code_ident\">HttpContext</span>.<span class=\"code_ident\">Current</span>.<span class=\"code_ident\">Request</span>,&#xA0;<span class=\"code_ident\">fakeResponse</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">fakeControllerContext</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">ControllerContext</span>(\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">HttpContextWrapper</span>(<span class=\"code_ident\">fakeContext</span>),\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">controller</span>.<span class=\"code_ident\">ControllerContext</span>.<span class=\"code_ident\">RouteData</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">controller</span>.<span class=\"code_ident\">ControllerContext</span>.<span class=\"code_ident\">Controller</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;store&#xA0;current&#xA0;context,&#xA0;and&#xA0;set&#xA0;fake&#xA0;one</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">oldContext</span>&#xA0;=&#xA0;<span class=\"code_ident\">HttpContext</span>.<span class=\"code_ident\">Current</span>;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">HttpContext</span>.<span class=\"code_ident\">Current</span>&#xA0;=&#xA0;<span class=\"code_ident\">fakeContext</span>;\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//Use&#xA0;HtmlHelper&#xA0;to&#xA0;render&#xA0;partial&#xA0;view&#xA0;to&#xA0;fake&#xA0;context&#xA0;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">html</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">HtmlHelper</span>(<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">ViewContext</span>(<span class=\"code_ident\">fakeControllerContext</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">FakeView</span>(),&#xA0;<span class=\"code_ident\">viewDataDictionary</span>,&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">TempDataDictionary</span>()),\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">ViewPage</span>());\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">html</span>.<span class=\"code_method\">RenderPartial</span>(<span class=\"code_ident\">viewName</span>,&#xA0;<span class=\"code_ident\">viewData</span>,&#xA0;<span class=\"code_ident\">viewDataDictionary</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//Restore&#xA0;context&#xA0;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">HttpContext</span>.<span class=\"code_ident\">Current</span>&#xA0;=&#xA0;<span class=\"code_ident\">oldContext</span>;\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//Flush&#xA0;memory&#xA0;and&#xA0;return&#xA0;output&#xA0;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">memWriter</span>.<span class=\"code_method\">Flush</span>();\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">return</span>&#xA0;<span class=\"code_ident\">sb</span>.<span class=\"code_method\">ToString</span>();\n<br>&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">///&#xA0;&lt;summary&gt;Fake&#xA0;IView&#xA0;implementation&#xA0;used&#xA0;to&#xA0;instantiate&#xA0;an&#xA0;HtmlHelper.&lt;/summary&gt;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">class</span>&#xA0;<span class=\"code_ident\">FakeView</span>&#xA0;:&#xA0;<span class=\"code_ident\">IView</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">void</span>&#xA0;<span class=\"code_method\">Render</span>(<span class=\"code_ident\">ViewContext</span>&#xA0;<span class=\"code_ident\">viewContext</span>,&#xA0;<span class=\"code_ident\">System</span>.<span class=\"code_ident\">IO</span>.<span class=\"code_ident\">TextWriter</span>&#xA0;<span class=\"code_ident\">writer</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">throw</span>&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">NotImplementedException</span>();\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>}</code></div></td></tr></table><br>\r\nVoor MVC 2 is de syntax iets anders, omdat je hier zelf een TextWriter kan defini&#xEB;ren waarheen geschreven wordt:<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">static</span>&#xA0;<span class=\"code_keyword\">class</span>&#xA0;<span class=\"code_ident\">RenderPartialViewHelper</span>\n<br>{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">///&#xA0;&lt;summary&gt;Renders&#xA0;a&#xA0;view&#xA0;to&#xA0;string.&lt;/summary&gt;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">static</span>&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_method\">RenderViewToString</span>(<span class=\"code_keyword\">this</span>&#xA0;<span class=\"code_ident\">Controller</span>&#xA0;<span class=\"code_ident\">controller</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">viewName</span>,&#xA0;<span class=\"code_keyword\">object</span>&#xA0;<span class=\"code_ident\">viewData</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//Create&#xA0;memory&#xA0;writer&#xA0;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">sb</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">StringBuilder</span>();\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">memWriter</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">StringWriter</span>(<span class=\"code_ident\">sb</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;Set&#xA0;some&#xA0;defaults</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">controller</span>.<span class=\"code_ident\">ControllerContext</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">ControllerContext</span>();\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">controller</span>.<span class=\"code_ident\">ControllerContext</span>.<span class=\"code_ident\">Controller</span>&#xA0;=&#xA0;<span class=\"code_ident\">controller</span>;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">controller</span>.<span class=\"code_ident\">ControllerContext</span>.<span class=\"code_ident\">RouteData</span>.<span class=\"code_ident\">Values</span>.<span class=\"code_method\">Add</span>(<span class=\"code_string\">&quot;controller&quot;</span>,&#xA0;<span class=\"code_ident\">controller</span>.<span class=\"code_method\">GetType</span>().<span class=\"code_ident\">Name</span>.<span class=\"code_method\">Replace</span>(<span class=\"code_string\">&quot;Controller&quot;</span>,&#xA0;<span class=\"code_string\">&quot;&quot;</span>));\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//Create&#xA0;fake&#xA0;http&#xA0;context&#xA0;to&#xA0;render&#xA0;the&#xA0;view&#xA0;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">fakeResponse</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">HttpResponse</span>(<span class=\"code_ident\">memWriter</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">fakeContext</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">HttpContext</span>(<span class=\"code_ident\">HttpContext</span>.<span class=\"code_ident\">Current</span>.<span class=\"code_ident\">Request</span>,&#xA0;<span class=\"code_ident\">fakeResponse</span>);\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">fakeControllerContext</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">ControllerContext</span>(\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">HttpContextWrapper</span>(<span class=\"code_ident\">fakeContext</span>),\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">controller</span>.<span class=\"code_ident\">ControllerContext</span>.<span class=\"code_ident\">RouteData</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">controller</span>.<span class=\"code_ident\">ControllerContext</span>.<span class=\"code_ident\">Controller</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">using</span>&#xA0;(<span class=\"code_ident\">MemoryStream</span>&#xA0;<span class=\"code_ident\">ms</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">MemoryStream</span>())\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">using</span>&#xA0;(<span class=\"code_ident\">TextWriter</span>&#xA0;<span class=\"code_ident\">tw</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">StreamWriter</span>(<span class=\"code_ident\">ms</span>))\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//Use&#xA0;HtmlHelper&#xA0;to&#xA0;render&#xA0;partial&#xA0;view&#xA0;to&#xA0;fake&#xA0;context&#xA0;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">var</span>&#xA0;<span class=\"code_ident\">html</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">HtmlHelper</span>(<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">ViewContext</span>(<span class=\"code_ident\">fakeControllerContext</span>,\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">FakeView</span>(),&#xA0;<span class=\"code_ident\">viewDataDictionary</span>,&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">TempDataDictionary</span>(),&#xA0;<span class=\"code_ident\">tw</span>),\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">ViewPage</span>());\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">html</span>.<span class=\"code_method\">RenderPartial</span>(<span class=\"code_ident\">viewName</span>,&#xA0;<span class=\"code_ident\">viewData</span>,&#xA0;<span class=\"code_ident\">viewDataDictionary</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">tw</span>.<span class=\"code_method\">Flush</span>();\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">ms</span>.<span class=\"code_method\">Seek</span>(<span class=\"code_number\">0</span>,&#xA0;<span class=\"code_ident\">SeekOrigin</span>.<span class=\"code_ident\">Begin</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">using</span>&#xA0;(<span class=\"code_ident\">StreamReader</span>&#xA0;<span class=\"code_ident\">sr</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">StreamReader</span>(<span class=\"code_ident\">ms</span>))\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">return</span>&#xA0;<span class=\"code_ident\">sr</span>.<span class=\"code_method\">ReadToEnd</span>();\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">///&#xA0;&lt;summary&gt;Fake&#xA0;IView&#xA0;implementation&#xA0;used&#xA0;to&#xA0;instantiate&#xA0;an&#xA0;HtmlHelper.&lt;/summary&gt;</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">class</span>&#xA0;<span class=\"code_ident\">FakeView</span>&#xA0;:&#xA0;<span class=\"code_ident\">IView</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">void</span>&#xA0;<span class=\"code_method\">Render</span>(<span class=\"code_ident\">ViewContext</span>&#xA0;<span class=\"code_ident\">viewContext</span>,&#xA0;<span class=\"code_ident\">System</span>.<span class=\"code_ident\">IO</span>.<span class=\"code_ident\">TextWriter</span>&#xA0;<span class=\"code_ident\">writer</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">throw</span>&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">NotImplementedException</span>();\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>}</code></div></td></tr></table><br>\r\n<br>\r\n<b>Custom Control</b><br>\r\nOm de bovenstaande code te gebruiken, moeten we een wrapper maken op basis van een CompositeControl; zodat we deze kunnen toevoegen in een Webforms pagina:<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br></code></td><td class=\"phphighlightcode\"><div><code>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">class</span>&#xA0;<span class=\"code_ident\">MvcViewControl</span>&#xA0;:&#xA0;<span class=\"code_ident\">CompositeControl</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">ViewName</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">object</span>&#xA0;<span class=\"code_ident\">ViewModel</span>&#xA0;{&#xA0;<span class=\"code_ident\">get</span>;&#xA0;<span class=\"code_ident\">set</span>;&#xA0;}&#xA0;\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">private</span>&#xA0;<span class=\"code_keyword\">string</span>&#xA0;<span class=\"code_ident\">RenderedData</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">get</span>&#xA0;{&#xA0;<span class=\"code_keyword\">return</span>&#xA0;<span class=\"code_ident\">ViewState</span>[<span class=\"code_keyword\">this</span>.<span class=\"code_ident\">UniqueID</span>&#xA0;+&#xA0;<span class=\"code_string\">&quot;.renderedData&quot;</span>]&#xA0;<span class=\"code_keyword\">as</span>&#xA0;<span class=\"code_keyword\">string</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">set</span>&#xA0;{&#xA0;<span class=\"code_ident\">ViewState</span>[<span class=\"code_keyword\">this</span>.<span class=\"code_ident\">UniqueID</span>&#xA0;+&#xA0;<span class=\"code_string\">&quot;.renderedData&quot;</span>]&#xA0;=&#xA0;<span class=\"code_ident\">value</span>;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_method\">MvcViewControl</span>()\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">base</span>.<span class=\"code_ident\">EnableViewState</span>&#xA0;=&#xA0;<span class=\"code_keyword\">true</span>;\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">override</span>&#xA0;<span class=\"code_keyword\">void</span>&#xA0;<span class=\"code_method\">RenderBeginTag</span>(<span class=\"code_ident\">System</span>.<span class=\"code_ident\">Web</span>.<span class=\"code_ident\">UI</span>.<span class=\"code_ident\">HtmlTextWriter</span>&#xA0;<span class=\"code_ident\">writer</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;geen&#xA0;begin&#xA0;tag</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">public</span>&#xA0;<span class=\"code_keyword\">override</span>&#xA0;<span class=\"code_keyword\">void</span>&#xA0;<span class=\"code_method\">RenderEndTag</span>(<span class=\"code_ident\">System</span>.<span class=\"code_ident\">Web</span>.<span class=\"code_ident\">UI</span>.<span class=\"code_ident\">HtmlTextWriter</span>&#xA0;<span class=\"code_ident\">writer</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_comment\">//&#xA0;ook&#xA0;niet</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">protected</span>&#xA0;<span class=\"code_keyword\">override</span>&#xA0;<span class=\"code_keyword\">void</span>&#xA0;<span class=\"code_method\">CreateChildControls</span>()\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">if</span>&#xA0;(<span class=\"code_ident\">RenderedData</span>&#xA0;==&#xA0;<span class=\"code_keyword\">null</span>)\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">RenderedData</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">BaseController</span>().<span class=\"code_method\">RenderViewToString</span>(<span class=\"code_ident\">ViewName</span>,&#xA0;<span class=\"code_ident\">ViewModel</span>);\n<br>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_keyword\">this</span>.<span class=\"code_ident\">Controls</span>.<span class=\"code_method\">Add</span>(<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">Literal</span>()\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Text</span>&#xA0;=&#xA0;<span class=\"code_ident\">RenderedData</span>\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;});\n<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}\n<br>&#xA0;&#xA0;&#xA0;&#xA0;}</code></div></td></tr></table><br>\r\n<br>\r\n<b>Gebruik</b><br>\r\nHet control kan eenvoudig worden gebruikt door eerst de namespace waarin je je control hebt toegevoegd te referencen, en deze vervolgens als normaal control te gebruiken:<br>\r\n<br>ASP.NET:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><pre>1\n2\n3\n</pre></td><td class=\"phphighlightcode\"><div><pre>&lt;%@ Register Assembly=&quot;Funda.Web.Common.MvcWrapper&quot; Namespace=&quot;Funda.Web.Common.MvcWrapper.CustomControls&quot; TagPrefix=&quot;mvc&quot; %&gt;\r\n\r\n&lt;mvc:MvcViewControl runat=&quot;server&quot; ViewName=&quot;~/views/shared/login.ascx&quot; ID=&quot;Login&quot;/&gt;</pre></div></td></tr></table><br>\r\n<br>\r\n<b>Model</b><br>\r\nWanneer je view een Model nodig hebt, dan kan je deze toevoegen in de codebehind.<br>\r\n<br>C#:<br><table class=\"phphighlight\"><tr><td class=\"phphighlightline\"><code>1<br>2<br>3<br>4<br></code></td><td class=\"phphighlightcode\"><div><code><span class=\"code_keyword\">protected</span>&#xA0;<span class=\"code_keyword\">void</span>&#xA0;<span class=\"code_method\">Page_Init</span>(<span class=\"code_keyword\">object</span>&#xA0;<span class=\"code_ident\">sender</span>,&#xA0;<span class=\"code_ident\">EventArgs</span>&#xA0;<span class=\"code_ident\">e</span>)\n<br>{\n<br>&#xA0;&#xA0;&#xA0;&#xA0;<span class=\"code_ident\">Login</span>.<span class=\"code_ident\">ViewControl</span>&#xA0;=&#xA0;<span class=\"code_keyword\">new</span>&#xA0;<span class=\"code_method\">LoginModel</span>(<span class=\"code_string\">&quot;Jan&#xA0;Jongboom&quot;</span>);\n<br>}</code></div></td></tr></table><br>\r\n<br>\r\nDone. Je kunt nu al je common controls gewoon schrijven in MVC.",
    "nextLink": "http://glamour.tweakblogs.net/blog/5892/non-javascript-fallbacks-in-asp-punt-net-mvc.html",
    "comments": [
        {
            "author": "mindcrash",
            "date": "donderdag 06 januari 2011 14:16",
            "contentHtml": "Nice hack <img src=\"http://tweakimg.net/g/s/smile.gif\" width=\"15\" height=\"15\" alt=\":)\"><br>\r\n<br>\r\nEr zit wel een foutje in je laatste codefragment. Volgens mij moet ViewControl ViewModel zijn. <br>\r\n<br>\r\nToch? <img src=\"http://tweakimg.net/g/s/wink.gif\" width=\"15\" height=\"15\" alt=\";)\"><br>\r\n<br>\r\n<small>offtopic: Zeg even hallo richting Teun en Dion van Cyriel <img src=\"http://tweakimg.net/g/s/wink.gif\" width=\"15\" height=\"15\" alt=\";)\"></small><p class=\"edit\">[Reactie gewijzigd op donderdag 06 januari 2011 14:24]</p>",
            "ownReply": false
        },
        {
            "author": "Fiander",
            "date": "vrijdag 07 januari 2011 07:21",
            "contentHtml": "Zou je in de &#xE9;&#xE9;n na onderste de namespace niet even aanpassen ?",
            "ownReply": false
        }
    ]
}